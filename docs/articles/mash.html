<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multivariate Adaptive Shrinkage • switchgrassGWAS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multivariate Adaptive Shrinkage">
<meta property="og:description" content="switchgrassGWAS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">switchgrassGWAS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/annotations.html">Annotation tables for top SNPs</a>
    </li>
    <li>
      <a href="../articles/gwas.html">Genome-Wide Association</a>
    </li>
    <li>
      <a href="../articles/mash.html">Multivariate Adaptive Shrinkage</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mash_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multivariate Adaptive Shrinkage</h1>
                        <h4 class="author">Alice MacQueen</h4>
            
            <h4 class="date">2020-01-06</h4>
      
      
      <div class="hidden name"><code>mash.Rmd</code></div>

    </div>

    
    
<div id="analysis-of-multiple-phenotypes-or-planting-locations" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-multiple-phenotypes-or-planting-locations" class="anchor"></a>Analysis of multiple phenotypes or planting locations</h2>
<p>Many researchers are measuring phenotypes on the <em>Panicum virgatum</em> diversity panel to understand the genes and genetic regions affecting these phenotypes. When similar phenotypes are collected at many locations, researchers may be interested in the extent to which effects of SNPs are similar or different across these different locations. The R package <code>mashr</code> can be used to conduct this kind of analysis, and downstream plotting functions in <code>switchgrassGWAS</code> can be used to further visualize and interpret the results of this analysis.</p>
<p>After you run your GWAS using bigsnpr, there are three steps to running a mash analysis. First, you must convert the bigsnpr results to mashr input format. Second, you run the mash analysis. Third, you can visualize the mash results using <code>mashr</code> functions or using functions from <code>switchgrassGWAS</code>.</p>
<div id="run-pvdiv_bigsnp2mashr-function" class="section level3">
<h3 class="hasAnchor">
<a href="#run-pvdiv_bigsnp2mashr-function" class="anchor"></a>1. Run <code>pvdiv_bigsnp2mashr</code> function</h3>
<p>The first three commands are setup for running the <code>pvdiv_bigsnp2mashr</code> function.</p>
<p>You want a character vector containing the names of the rds files containing your GWAS results - you can find that with <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code> or with <code><a href="../reference/pvdiv_results_in_folder.html">pvdiv_results_in_folder()</a></code>. The path should be the location of the gwas files, and can be a relative or absolute path. The pattern to match can be anything, but defaults to "*.rds". Here I have used regular expressions to find four files to demonstrate mashr on.</p>
<p>Second, you what a character vector the same length as the one containing your GWAS rds files. This contains strings of whatever you want your phenotypic column names to ultimately be. If you’ve put the phenotype name into the GWAS rds file name (which I’d certainly recommend!), you can find this with a str_sub() command.</p>
<p>Third, you want to calculate the number of SNPs with low p-values to select from each GWAS. Ideally mash will have from 1-2M cells for reasonable run times. You can divide 2 million by the square of the number of phenotypes you have to get a reasonable starting point for this value. Depending on your computing power and the amount of overlap of low p-value SNPs between your GWAS, you may need to tweak this number further.</p>
<p>Finally, you run the <code><a href="../reference/pvdiv_bigsnp2mashr.html">pvdiv_bigsnp2mashr()</a></code> function using these quantities. Choose the model type that you ran on your GWAS. Current options are “logistic” or “linear”. Mixing these types is not supported (and statistically is probably a bad idea, also.) Also choose whether you want to save the output to a file in your path - recommended, though the default is FALSE, so the user needs to ‘opt in’ to this.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">pvdiv_phenotypes</span><span class="op">)</span>
<span class="va">gwas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pvdiv_gwas.html">pvdiv_gwas</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pvdiv_phenotypes</span>, type <span class="op">=</span> <span class="st">"linear"</span>,
                   snp <span class="op">=</span> <span class="va">snp</span>, covar <span class="op">=</span> <span class="va">svd0</span>, ncores <span class="op">=</span> <span class="va">NCORES</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"markers.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"markers2.rda"</span><span class="op">)</span>
<span class="va">snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://privefl.github.io/bigsnpr/reference/snp_attach.html">snp_attach</a></span><span class="op">(</span><span class="st">"Pvirgatum_4x_784g_imp_phased_maf0.02_QC.rds"</span><span class="op">)</span>
<span class="va">G</span> <span class="op">&lt;-</span> <span class="va">snp</span><span class="op">$</span><span class="va">genotypes</span>
<span class="va">gwas_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pvdiv_results_in_folder.html">pvdiv_results_in_folder</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"."</span>, pattern <span class="op">=</span> <span class="st">"GWAS_object_"</span><span class="op">)</span>

<span class="va">phenotype_names</span> <span class="op">&lt;-</span> <span class="fu">str_sub</span><span class="op">(</span><span class="va">gwas_rds</span>, start <span class="op">=</span> <span class="fl">13</span>, end <span class="op">=</span> <span class="op">-</span><span class="fl">5</span><span class="op">)</span>

<span class="va">numSNPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fl">1500000</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">phenotype_names</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>

<span class="va">mash_input</span> <span class="op">&lt;-</span> <span class="fu">bigsnp2mashr</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"."</span>, gwas_rds <span class="op">=</span> <span class="va">gwas_rds</span>, 
                           phenotypes <span class="op">=</span> <span class="va">phenotype_names</span>, numSNPs <span class="op">=</span> <span class="va">numSNPs</span>, 
                           markers <span class="op">=</span> <span class="va">markers</span>, markers2 <span class="op">=</span> <span class="va">markers2</span>, G <span class="op">=</span> <span class="va">G</span>, 
                           model <span class="op">=</span> <span class="st">"linear"</span>, saveoutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="run-a-standard-mash-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#run-a-standard-mash-analysis" class="anchor"></a>2. Run a standard mash analysis</h3>
<p>Here, the input is the list object you obtained from <code>bigsnp2mashr()</code> in the previous step. Again, you can choose to save the output to a file in your path. You can optionally specify <code>numSNPs</code>, or if you are running this in a session where you don’t have the output from <code>bigsnp2mashr()</code> in your environment, you can specify <code>numSNPs</code> equivalent to your <code>bigsnp2mashr()</code> run and this function will find the rds files it saved (on that path, with that number of SNPs) for you.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mash_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mash_standard_run.html">mash_standard_run</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"."</span>, list_input <span class="op">=</span> <span class="va">mash_input</span>, 
                                  numSNPs <span class="op">=</span> <span class="va">numSNPs</span>, saveoutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Or, if you are doing this in a new session and don't have mash_input </span>
<span class="co">#     in your workspace, you just need to enter the number of SNPs and this </span>
<span class="co">#     function will find a previously saved rds file with that numSNPs for you:</span>
<span class="co"># mash_output &lt;- mash_standard_run(path = ".", numSNPs = numSNPs,</span>
<span class="co">#                                  saveoutput = TRUE)</span></code></pre></div>
</div>
<div id="visualize-mash-output" class="section level3">
<h3 class="hasAnchor">
<a href="#visualize-mash-output" class="anchor"></a>3. Visualize mash output</h3>
<p>You have a lot of options here, and some great ones (most importantly, <code>mash_plot_meta</code>) are already included in the <code>mashr</code> package.</p>
<p>However, this package adds a few additional options for viewing mash outputs.</p>
<div id="a--number-of-significant-snps-per-number-of-conditions" class="section level4">
<h4 class="hasAnchor">
<a href="#a--number-of-significant-snps-per-number-of-conditions" class="anchor"></a>3a. Number of Significant SNPs per Number of Conditions</h4>
<p>This plot can help answer questions like, “at how many planting sites do SNPs affect this phenotype?”</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nbycond</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mash_plot_sig_by_condition.html">mash_plot_sig_by_condition</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">mash_output</span><span class="op">)</span>
<span class="va">nbycond</span><span class="op">$</span><span class="va">ggobject</span></code></pre></div>
<p><img src="vignettes/man/figures/mash-unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="b--manhattan-esque-plot-mashhattan" class="section level4">
<h4 class="hasAnchor">
<a href="#b--manhattan-esque-plot-mashhattan" class="anchor"></a>3b. Manhattan-esque plot (“Mashhattan”)</h4>
<p>This plot can help answer questions like, “What is the genomic distribution of SNPs with significant effects, and at how many planting sites do these SNPs affect the phenotype?”</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mashhattan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mash_plot_manhattan_by_condition.html">mash_plot_manhattan_by_condition</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">mash_output</span><span class="op">)</span>
<span class="va">mashhattan</span><span class="op">$</span><span class="va">ggmanobject</span></code></pre></div>
<p><img src="vignettes/man/figures/mash-unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="c--pairwise-sharing-of-similar-effects" class="section level4">
<h4 class="hasAnchor">
<a href="#c--pairwise-sharing-of-similar-effects" class="anchor"></a>3c. Pairwise sharing of similar effects</h4>
<p>This plot can help answer questions like, “How many SNPs have similar effects at pairs of planting sites?”. As most analyses of GxE typically only consider interactions between pairs of sites, this plot is a useful extension of two-site models.</p>
<p>If you saved the output of a mash_standard_run(), then you have saved two get_pairwise_sharing() outputs as rds objects already. All you need to do then is tell this function 1) the path to the RDS, for effectRDS; or 2) the correlation matrix you’re using if it’s an object in your environment, for corrmatrix.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pairwise_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mash_plot_pairwise_sharing.html">mash_plot_pairwise_sharing</a></span><span class="op">(</span>effectRDS <span class="op">=</span> <span class="va">pairwisefilepath</span>,
                                            reorder <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> 
<span class="co">#&gt; Loading required namespace: dots</span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>
<span class="va">pairwise_plot</span><span class="op">$</span><span class="va">gg_corr</span></code></pre></div>
<p><img src="vignettes/man/figures/mash-unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="d--look-at-mash-effect-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#d--look-at-mash-effect-plots" class="anchor"></a>3d. Look at mash effect plots</h4>
<p>This plot can help answer questions like, “What are the effects of a single SNP on the phenotype across planting sites?”</p>
<p>This will return ggplot objects for the effect plots for the <code>n</code>th significant SNP, ranked by the most significant local false sign rate. You can find the names of the top ten effects, for example, using <code>get_significant_results(m = mashoutput)[1:10]</code>.</p>
<p>Alternatively, if you have the row number of the SNP you want to plot (which you can find with <code><a href="../reference/get_marker_df.html">get_marker_df()</a></code>), you can put that in as <code>i</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mash_plot_effects.html">mash_plot_effects</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">mash_output</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">effects</span><span class="op">$</span><span class="va">ggobject</span> </code></pre></div>
<p><img src="vignettes/man/figures/mash-unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alice MacQueen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
