<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Genome Wide Association on Panicum virgatum • switchgrassGWAS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Genome Wide Association on Panicum virgatum">
<meta property="og:description" content="The switchgrass (Panicum virgatum) diversity panel
    is now being grown at many locations across the United States and
    Mexico. Many researchers are measuring phenotypes on this panel to
    understand the genes and genetic regions affecting these phenotypes.
    This package provides the code for fast, less memory intensive genome- 
    wide association (GWAS) using bigsnpr. It also provides functions to link 
    diversity panel phenotypic data with SNP data, to prepare basic plots
    for further customization, and to prepare multiple GWAS results for
    use in the downstream application mash.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">switchgrassGWAS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="switchgrassgwas" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#switchgrassgwas" class="anchor"></a>switchgrassGWAS</h1></div>
<!-- badges: start -->

<p>The goal of switchgrassGWAS is to allow fast, powerful genome-wide association analysis on the <em>Panicum virgatum</em> diversity panel.</p>
<p>The switchgrass (<em>Panicum virgatum</em>) diversity panel is now being grown at many locations across the United States and Mexico. Many researchers are measuring phenotypes on this panel to understand the genes and genetic regions affecting these phenotypes. This package provides the code for fast, less memory intensive genome-wide association (GWAS) using bigsnpr. It also provides functions to link diversity panel phenotypic data with SNP data, to prepare basic plots in ggplot for further customization, and to prepare multiple GWAS results for use in the downstream application mash.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span>
<span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">"multtest"</span><span class="op">)</span>

<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"devtools"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"privefl/bigsnpr"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"stephens999/ashr"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"Alice-MacQueen/switchgrassGWAS"</span><span class="op">)</span></code></pre></div>
<p>This will give you access to the code, example phenotypes, and the currently available information about the genotypes in the switchgrass diversity panel.</p>
<div id="installations-for-additional-functionality" class="section level3">
<h3 class="hasAnchor">
<a href="#installations-for-additional-functionality" class="anchor"></a>Installations for additional functionality</h3>
<p>To use some of the optional functions in this package, you will need to install some additional packages, either from Bioconductor or from Github. The Bioconductor packages are needed to create dataframes containing annotation information.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span>

<span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"multtest"</span>, <span class="st">"GenomicFeatures"</span>, <span class="st">"GenomicRanges"</span>, 
                     <span class="st">"IRanges"</span>, <span class="st">"VariantAnnotation"</span>, <span class="st">"AnnotationDbi"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>mashr is needed <em><em>only</em></em> if you want to use the <code>mash_standard_run</code> function. It is not needed for any of the downstream plotting functions. <em>NB: mashr can only be installed on Linux or Mac operating systems. It cannot be installed on Windows systems.</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"stephenslab/mashr@v0.2-11"</span><span class="op">)</span></code></pre></div>
<p>Some plotting functions also use the dots package, which allows you to specify more plotting arguments specific to each function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"lcolladotor/dots"</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="obtaining-the-genomic-information" class="section level1">
<h1 class="hasAnchor">
<a href="#obtaining-the-genomic-information" class="anchor"></a>Obtaining the Genomic Information</h1>
<p><em>As of this writing, not all of the genomic information is publicly available.</em> If you would like access to this information pre-publication, please contact Tom Juenger at tjuenger AT utexas DOT edu.</p>
<p>To use this package prior to publication of the switchgrass genomic data, you’ll need to request access to the genomic information, then download this information and put it in your working directory. Then, you can load the information into your R environment using the following commands:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://privefl.github.io/bigsnpr/">bigsnpr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/AnnotationDbi">AnnotationDbi</a></span><span class="op">)</span>

<span class="va">snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://privefl.github.io/bigsnpr/reference/snp_attach.html">snp_attach</a></span><span class="op">(</span><span class="st">"Pvirgatum_4x_784g_imp_phased_maf0.02_QC.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"svd0.rda"</span><span class="op">)</span>
<span class="va">txdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">loadDb</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Pvirgatum_516_v5.1.gene.txdb.sqlite"</span><span class="op">)</span></code></pre></div>
<div id="genome-wide-association" class="section level2">
<h2 class="hasAnchor">
<a href="#genome-wide-association" class="anchor"></a>Genome-Wide Association</h2>
<p>You can use <code>pvdiv_gwas</code> to run linear or logistic univariate regression on 21 million SNPs with a minor allele frequency of 2% or higher. The following example demonstrates running a genome-wide association on a continuous trait via linear regression. The trait is tiller count at the end of the 2018 season in Brookings, South Dakota.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NCORES</span> <span class="op">&lt;-</span> <span class="fu">nb_cores</span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">phenotypes</span><span class="op">)</span> 

<span class="va">one_phenotype</span> <span class="op">&lt;-</span> <span class="va">phenotypes</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">PLANT_ID</span>, <span class="va">BRKG_TC_EOS_2018</span><span class="op">)</span>

<span class="va">gwas</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pvdiv_gwas.html">pvdiv_gwas</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">one_phenotype</span>, type <span class="op">=</span> <span class="st">"linear"</span>,
                     snp <span class="op">=</span> <span class="va">snp</span>, covar <span class="op">=</span> <span class="va">svd0</span>, ncores <span class="op">=</span> <span class="va">NCORES</span><span class="op">)</span></code></pre></div>
<p>You can then plot the results of this GWAS using built in functions in bigsnpr.</p>
<p>Note that while the GWAS will run quickly, the plotting functions take about ten times as long to run, because of the large number of datapoints to plot (&gt;21 million).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://privefl.github.io/bigsnpr/reference/snp_manhattan.html">snp_manhattan</a></span><span class="op">(</span><span class="va">gwas</span>, infos.chr <span class="op">=</span> <span class="va">CHRN</span><span class="op">$</span><span class="va">CHRN</span>, infos.pos <span class="op">=</span> <span class="va">POS</span><span class="op">)</span>
<span class="fu"><a href="https://privefl.github.io/bigsnpr/reference/snp_qq.html">snp_qq</a></span><span class="op">(</span><span class="va">gwas</span><span class="op">)</span></code></pre></div>
<div id="annotations-for-top-associations" class="section level3">
<h3 class="hasAnchor">
<a href="#annotations-for-top-associations" class="anchor"></a>Annotations for Top Associations</h3>
<p>You can also use <code>pvdiv_table_topsnps</code> to create dataframes containing annotation information. To do this, first load the provided annotation information. Currently, this is version 5.1 of the annotation information for <em>Panicum virgatum</em>.</p>
<p>If you have saved the genomic files you requested access to in your working directory, you would then run the following commands to load the annotation data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/AnnotationDbi">AnnotationDbi</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">VariantAnnotation</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"markers.rda"</span><span class="op">)</span>
<span class="va">txdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">loadDb</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Pvirgatum_516_v5.1.gene.txdb.sqlite"</span><span class="op">)</span>
<span class="va">anno_info</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Pvirgatum_516_v5.1.annotation_info.txt"</span>,
                        col_names <span class="op">=</span> <span class="cn">TRUE</span>, delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span>
<span class="va">gene_anno_info</span> <span class="op">&lt;-</span> <span class="fu">tbl_df</span><span class="op">(</span><span class="va">anno_info</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="va">locusName</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>You can select a number of top SNPs to find annotation information for, a FDR threshold to find annotation information for, and any distance away from the associated SNP (in bp) for which to pull annotations. Here, we find genes 10kb and 100kb away from the top 50 associations and for associations above a FDR of 5%.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anno_tables</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pvdiv_table_topsnps.html">pvdiv_table_topsnps</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">gwas</span>, type <span class="op">=</span> <span class="st">"bigsnp"</span>, n <span class="op">=</span> <span class="fl">50</span>, 
                                  FDRalpha <span class="op">=</span> <span class="fl">0.05</span>, rangevector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">100000</span><span class="op">)</span>,
                                  markers <span class="op">=</span> <span class="va">markers</span>, anno_info <span class="op">=</span> <span class="va">gene_anno_info</span>,
                                  txdb <span class="op">=</span> <span class="va">txdb</span><span class="op">)</span>
                                 
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">anno_tables</span>, <span class="st">"Annotation_tables_BRKG_TC_EOS_2018.rds"</span><span class="op">)</span></code></pre></div>
<p>This function will return a list of all of the tables you requested, named according to the criteria used to create the table. You can then save these tables individually as csv or any other type of file.</p>
<p>If the resultant tables are small, say, less than 2000 entries apiece, we favor saving these tables as individual sheets in an Excel file using the R package <code>XLConnect</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">XLConnect</span><span class="op">)</span>

<span class="va">wb1</span> <span class="op">&lt;-</span> <span class="fu">loadWorkbook</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"Annotation_tables_BRKG_TC_EOS_2018.xlsx"</span>, 
                    create <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">anno_tables</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">createSheet</span><span class="op">(</span><span class="va">wb1</span>, name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">anno_tables</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="fu">writeWorksheet</span><span class="op">(</span><span class="va">wb1</span>, <span class="va">anno_tables</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>, sheet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">anno_tables</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="fu">saveWorkbook</span><span class="op">(</span><span class="va">wb1</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="analysis-of-multiple-phenotypes-or-planting-locations" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-multiple-phenotypes-or-planting-locations" class="anchor"></a>Analysis of multiple phenotypes or planting locations</h2>
<p>Many researchers are measuring phenotypes on the <em>Panicum virgatum</em> diversity panel to understand the genes and genetic regions affecting these phenotypes. When similar phenotypes are collected at many locations, researchers may be interested in the extent to which effects of SNPs are similar or different across these different locations. The R package <code>mashr</code> can be used to conduct this kind of analysis, and downstream plotting functions in <code>switchgrassGWAS</code> can be used to further visualize and interpret the results of this analysis.</p>
<p>After you run your GWAS using bigsnpr, there are three steps to running a mash analysis. First, you must convert the bigsnpr results to mashr input format. Second, you run the mash analysis. Third, you can visualize the mash results using <code>mashr</code> functions or using functions from <code>switchgrassGWAS</code>.</p>
<div id="1-run-pvdiv_bigsnp2mashr-function" class="section level3">
<h3 class="hasAnchor">
<a href="#1-run-pvdiv_bigsnp2mashr-function" class="anchor"></a>1. Run <code>pvdiv_bigsnp2mashr</code> function</h3>
<p>The first three commands are setup for running the <code>pvdiv_bigsnp2mashr</code> function.</p>
<p>You want a character vector containing the names of the rds files containing your GWAS results - you can find that with <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code> or with <code><a href="reference/pvdiv_results_in_folder.html">pvdiv_results_in_folder()</a></code>. The path should be the location of the gwas files, and can be a relative or absolute path. The pattern to match can be anything, but defaults to “*.rds”. Here I have used regular expressions to find four files to demonstrate mashr on.</p>
<p>Second, you what a character vector the same length as the one containing your GWAS rds files. This contains strings of whatever you want your phenotypic column names to ultimately be. If you’ve put the phenotype name into the GWAS rds file name (which I’d certainly recommend!), you can find this with a str_sub() command.</p>
<p>Third, you want to calculate the number of SNPs with low p-values to select from each GWAS. Ideally mash will have from 1-2M cells for reasonable run times. You can divide 2 million by the square of the number of phenotypes you have to get a reasonable starting point for this value. Depending on your computing power and the amount of overlap of low p-value SNPs between your GWAS, you may need to tweak this number further.</p>
<p>Finally, you run the <code><a href="reference/pvdiv_bigsnp2mashr.html">pvdiv_bigsnp2mashr()</a></code> function using these quantities. Choose the model type that you ran on your GWAS. Current options are “logistic” or “linear”. Mixing these types is not supported (and statistically is probably a bad idea, also.) Also choose whether you want to save the output to a file in your path - recommended, though the default is FALSE, so the user needs to ‘opt in’ to this.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">phenotypes</span><span class="op">)</span>
<span class="va">gwas</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pvdiv_gwas.html">pvdiv_gwas</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">phenotypes</span>, type <span class="op">=</span> <span class="st">"linear"</span>,
                   snp <span class="op">=</span> <span class="va">snp</span>, covar <span class="op">=</span> <span class="va">svd0</span>, ncores <span class="op">=</span> <span class="va">NCORES</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"markers.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"markers2.rda"</span><span class="op">)</span>
<span class="va">snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://privefl.github.io/bigsnpr/reference/snp_attach.html">snp_attach</a></span><span class="op">(</span><span class="st">"Pvirgatum_4x_784g_imp_phased_maf0.02_QC.rds"</span><span class="op">)</span>
<span class="va">G</span> <span class="op">&lt;-</span> <span class="va">snp</span><span class="op">$</span><span class="va">genotypes</span>
<span class="va">gwas_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pvdiv_results_in_folder.html">pvdiv_results_in_folder</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"."</span>, pattern <span class="op">=</span> <span class="st">"GWAS_object_"</span><span class="op">)</span>

<span class="va">phenotype_names</span> <span class="op">&lt;-</span> <span class="fu">str_sub</span><span class="op">(</span><span class="va">gwas_rds</span>, start <span class="op">=</span> <span class="fl">13</span>, end <span class="op">=</span> <span class="op">-</span><span class="fl">5</span><span class="op">)</span>

<span class="va">numSNPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fl">1500000</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">phenotype_names</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>

<span class="va">mash_input</span> <span class="op">&lt;-</span> <span class="fu">bigsnp2mashr</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"."</span>, gwas_rds <span class="op">=</span> <span class="va">gwas_rds</span>, 
                           phenotypes <span class="op">=</span> <span class="va">phenotype_names</span>, numSNPs <span class="op">=</span> <span class="va">numSNPs</span>, 
                           markers <span class="op">=</span> <span class="va">markers</span>, markers2 <span class="op">=</span> <span class="va">markers2</span>, G <span class="op">=</span> <span class="va">G</span>, 
                           model <span class="op">=</span> <span class="st">"linear"</span>, saveoutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="2-run-a-standard-mash-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#2-run-a-standard-mash-analysis" class="anchor"></a>2. Run a standard mash analysis</h3>
<p>Here, the input is the list object you obtained from <code>bigsnp2mashr()</code> in the previous step. Again, you can choose to save the output to a file in your path. You can optionally specify <code>numSNPs</code>, or if you are running this in a session where you don’t have the output from <code>bigsnp2mashr()</code> in your environment, you can specify <code>numSNPs</code> equivalent to your <code>bigsnp2mashr()</code> run and this function will find the rds files it saved (on that path, with that number of SNPs) for you.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mash_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mash_standard_run.html">mash_standard_run</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"."</span>, list_input <span class="op">=</span> <span class="va">mash_input</span>, 
                                  numSNPs <span class="op">=</span> <span class="va">numSNPs</span>, saveoutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Or, if you are doing this in a new session and don't have mash_input </span>
<span class="co">#     in your workspace, you just need to enter the number of SNPs and this </span>
<span class="co">#     function will find a previously saved rds file with that numSNPs for you:</span>
<span class="co"># mash_output &lt;- mash_standard_run(path = ".", numSNPs = numSNPs,</span>
<span class="co">#                                  saveoutput = TRUE)</span></code></pre></div>
</div>
<div id="3-visualize-mash-output" class="section level3">
<h3 class="hasAnchor">
<a href="#3-visualize-mash-output" class="anchor"></a>3. Visualize mash output</h3>
<p>You have a lot of options here, and some great ones (most importantly, <code>mash_plot_meta</code>) are already included in the <code>mashr</code> package.</p>
<p>However, this package adds a few additional options for viewing mash outputs.</p>
<div id="3a-number-of-significant-snps-per-number-of-conditions" class="section level4">
<h4 class="hasAnchor">
<a href="#3a-number-of-significant-snps-per-number-of-conditions" class="anchor"></a>3a. Number of Significant SNPs per Number of Conditions</h4>
<p>This plot can help answer questions like, “at how many planting sites do SNPs affect this phenotype?”</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nbycond</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mash_plot_sig_by_condition.html">mash_plot_sig_by_condition</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">mash_output</span><span class="op">)</span>
<span class="va">nbycond</span><span class="op">$</span><span class="va">ggobject</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="3b-manhattan-esque-plot-mashhattan" class="section level4">
<h4 class="hasAnchor">
<a href="#3b-manhattan-esque-plot-mashhattan" class="anchor"></a>3b. Manhattan-esque plot (“Mashhattan”)</h4>
<p>This plot can help answer questions like, “What is the genomic distribution of SNPs with significant effects, and at how many planting sites do these SNPs affect the phenotype?”</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mashhattan</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mash_plot_manhattan_by_condition.html">mash_plot_manhattan_by_condition</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">mash_output</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "value"</span>
<span class="va">mashhattan</span><span class="op">$</span><span class="va">ggmanobject</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="3c-pairwise-sharing-of-similar-effects" class="section level4">
<h4 class="hasAnchor">
<a href="#3c-pairwise-sharing-of-similar-effects" class="anchor"></a>3c. Pairwise sharing of similar effects</h4>
<p>This plot can help answer questions like, “How many SNPs have similar effects at pairs of planting sites?”. As most analyses of GxE typically only consider interactions between pairs of sites, this plot is a useful extension of two-site models.</p>
<p>If you saved the output of a mash_standard_run(), then you have saved two get_pairwise_sharing() outputs as rds objects already. All you need to do then is tell this function 1) the path to the RDS, for effectRDS; or 2) the correlation matrix you’re using if it’s an object in your environment, for corrmatrix.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pairwise_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mash_plot_pairwise_sharing.html">mash_plot_pairwise_sharing</a></span><span class="op">(</span>effectRDS <span class="op">=</span>                                      <span class="st">"data-raw/Pairwise_sharing_Strong_Effects_5000SNPs.rds"</span>,
                                            reorder <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> 
<span class="co">#&gt; Loading required namespace: dots</span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for</span>
<span class="co">#&gt; 'colour', which will replace the existing scale.</span>
<span class="va">pairwise_plot</span><span class="op">$</span><span class="va">gg_corr</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="3d-look-at-mash-effect-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#3d-look-at-mash-effect-plots" class="anchor"></a>3d. Look at mash effect plots</h4>
<p>This plot can help answer questions like, “What are the effects of a single SNP on the phenotype across planting sites?”</p>
<p>This will return ggplot objects for the effect plots for the <code>n</code>th significant SNP, ranked by the most significant local false sign rate. You can find the names of the top ten effects, for example, using <code>get_significant_results(m = mashoutput)[1:10]</code>.</p>
<p>Alternatively, if you have the row number of the SNP you want to plot (which you can find with <code><a href="reference/get_marker_df.html">get_marker_df()</a></code>), you can put that in as <code>i</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mash_plot_effects.html">mash_plot_effects</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">mash_output</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">effects</span><span class="op">$</span><span class="va">ggobject</span> <span class="op">+</span>
    <span class="fu">scale_x_discrete</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">str_sub</span><span class="op">(</span><span class="fu">as_vector</span><span class="op">(</span><span class="va">effects</span><span class="op">$</span><span class="va">effect_df</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>, 
                                      start <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Scale for 'x' is already present. Adding another scale for 'x', which</span>
<span class="co">#&gt; will replace the existing scale.</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="3e-visualizing-gxe" class="section level4">
<h4 class="hasAnchor">
<a href="#3e-visualizing-gxe" class="anchor"></a>3e. Visualizing GxE</h4>
<p>The get_GxE function is still a little buggy for switchgrass. To be completed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GxE_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_GxE.html">get_GxE</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">mash_output</span><span class="op">)</span>

<span class="fu"><a href="reference/mash_plot_pairwise_sharing.html">mash_plot_pairwise_sharing</a></span><span class="op">(</span>corrmatrix <span class="op">=</span> <span class="va">GxE_df</span><span class="op">$</span><span class="va">S_AP</span>, reorder <span class="op">=</span> <span class="cn">FALSE</span>,
                           saveoutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="reference/mash_plot_pairwise_sharing.html">mash_plot_pairwise_sharing</a></span><span class="op">(</span>corrmatrix <span class="op">=</span> <span class="va">GxE_df</span><span class="op">$</span><span class="va">S_DS</span>, reorder <span class="op">=</span> <span class="cn">FALSE</span>,
                           saveoutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="reference/mash_plot_pairwise_sharing.html">mash_plot_pairwise_sharing</a></span><span class="op">(</span>corrmatrix <span class="op">=</span> <span class="va">GxE_df</span><span class="op">$</span><span class="va">S_2_no</span>, reorder <span class="op">=</span> <span class="cn">FALSE</span>,
                           saveoutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Alice MacQueen <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/Alice-MacQueen/switchgrassGWAS"><img src="https://travis-ci.org/Alice-MacQueen/switchgrassGWAS.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://ci.appveyor.com/project/Alice-MacQueen/switchgrassGWAS"><img src="https://ci.appveyor.com/api/projects/status/github/Alice-MacQueen/switchgrassGWAS?branch=master&amp;svg=true" alt="AppVeyor build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Alice MacQueen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
